<?php if (!defined("BASEPATH")) { exit("No direct script access allowed"); } class Notificacoes extends MY_Controller { public function __construct() { parent::__construct(); $this->load->model("notificacoes_model"); $this->data["menuNotificacoes"] = "Notificacoes"; } public function index() { $this->gerenciar(); } public function gerenciar() { if (!$this->permission->checkPermission($this->session->userdata("permissao"), "vNotificacao")) { $this->session->set_flashdata("error", "Você não tem permissão para visualizar notificações."); redirect(base_url()); } $this->load->library("pagination"); $this->data["configuration"]["base_url"] = site_url("notificacoes/gerenciar/"); $this->data["configuration"]["total_rows"] = $this->notificacoes_model->count("notificacoes"); $this->pagination->initialize($this->data["configuration"]); $this->data["results"] = $this->notificacoes_model->get("notificacoes", "*", "", $this->data["configuration"]["per_page"], $this->uri->segment(3)); $this->data["view"] = "notificacoes/notificacoes"; return $this->layout(); } public function adicionar() { if (!$this->permission->checkPermission($this->session->userdata("permissao"), "aNotificacao")) { $this->session->set_flashdata("error", "Você não tem permissão para adicionar notificações."); redirect(base_url()); } $this->load->library("form_validation"); $this->data["custom_error"] = ""; if ($this->form_validation->run("notificacoes") == false) { $this->data["custom_error"] = (validation_errors() ? "<div class=\"form_error\">" . validation_errors() . "</div>" : false); } else { $data = [ "titulo" => $this->input->post("titulo"), "mensagem" => $this->input->post("mensagem"), "data_envio" => date("Y-m-d H:i:s"), "status" => $this->input->post("status"), "usuarios_id" => $this->session->userdata("id_admin"), ]; if ($this->notificacoes_model->add("notificacoes", $data) == true) { $this->session->set_flashdata("success", "Notificação adicionada com sucesso!"); log_info("Adicionou uma notificação"); redirect(site_url("notificacoes/adicionar/")); } else { $this->data["custom_error"] = "<div class=\"form_error\"><p>Ocorreu um erro.</p></div>"; } } $this->data["view"] = "notificacoes/adicionarNotificacao"; return $this->layout(); } public function editar() { if (!$this->uri->segment(3) || !is_numeric($this->uri->segment(3))) { $this->session->set_flashdata("error", "Item não pode ser encontrado, parâmetro não foi passado corretamente."); redirect("axcell"); } if (!$this->permission->checkPermission($this->session->userdata("permissao"), "eNotificacao")) { $this->session->set_flashdata("error", "Você não tem permissão para editar notificações."); redirect(base_url()); } $this->load->library("form_validation"); $this->data["custom_error"] = ""; if ($this->form_validation->run("notificacoes") == false) { $this->data["custom_error"] = (validation_errors() ? "<div class=\"form_error\">" . validation_errors() . "</div>" : false); } else { $data = [ "titulo" => $this->input->post("titulo"), "mensagem" => $this->input->post("mensagem"), "status" => $this->input->post("status"), ]; if ($this->notificacoes_model->edit("notificacoes", $data, "idNotificacao", $this->input->post("idNotificacao")) == true) { $this->session->set_flashdata("success", "Notificação editada com sucesso!"); log_info("Alterou uma notificação. ID: " . $this->input->post("idNotificacao")); redirect(site_url("notificacoes/editar/") . $this->input->post("idNotificacao")); } else { $this->data["custom_error"] = "<div class=\"form_error\"><p>Ocorreu um erro</p></div>"; } } $this->data["result"] = $this->notificacoes_model->getById($this->uri->segment(3)); $this->data["view"] = "notificacoes/editarNotificacao"; return $this->layout(); } public function excluir() { if (!$this->permission->checkPermission($this->session->userdata("permissao"), "dNotificacao")) { $this->session->set_flashdata("error", "Você não tem permissão para excluir notificações."); redirect(base_url()); } $id = $this->input->post("id"); if ($id == null) { $this->session->set_flashdata("error", "Erro ao tentar excluir notificação."); redirect(base_url() . "index.php/notificacoes/gerenciar/"); } $this->notificacoes_model->delete("notificacoes", "idNotificacao", $id); log_info("Removeu uma notificação. ID: " . $id); $this->session->set_flashdata("success", "Notificação excluída com sucesso!"); redirect(site_url("notificacoes/gerenciar/")); } }

